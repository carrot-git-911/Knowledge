---

---

## Dataview 中的 Metadata

> [!check] metadata 元数据
> **元数据** 又称中介数据、中继数据，为描述数据的数据（data about data），主要是关于数据的组织、数据域及其关系的信息

一个元属性包含两个部分：Key 和 Value（其实就是一个键值对），假如 Key 是 name，对应的 Value 就是具体的名字。

> [!warning] 在后续描述中，会
> 把 Key 称为 “属性名 Field Name”
> 把 Value 称为 “属性域 Field”；

示例：
dataview
TABLE this
WHERE file = this.file



元数据是关于数据的结构化数据，包含了文件的许多信息，这种一一对应的信息，仿佛天然就是为了作为一种索引，用以辅助查询

对于 Dataview 来说，他无法直接查询文档中的内容，只能查询有索引的内容。文件中只有元数据和隐式字段是具有索引的：
- 文件的元数据：在文件中，有两种东西可以有元数据，分别是**文件本身**和**文件中的列表**，其中文件本身的元数据分别来自文件的文档属性和文中的内联字段，文件中列表的元数据一般放在该列表的末尾（列表包括无序列表、有序列表和任务）。这些元数据与这篇文件绑定，可以被 Dataview 检索作为分类的依据或者作为展示的内容。

- 文件的隐式字段：文件中还有一些已经自动有索引的内容，比如文件的名字，文件的创建时间、修改时间等，我们称之为文件的隐式字段。他们也是能够被 Dataview 检索到的。

## 向文件添加元数据

### 方法

快捷键法：ctrl + ; mac 为 cmd + ;
命令面板法：ctrl + p，搜索添加文档属性 (英文为 add file property)；(没找到)
鼠标右键文件标题：选择增加文档属性 (英文为 add file property)；(没找到)
标签页标题栏的竖着的三个点：选择增加文档属性 (英文为 add file property)； 
原来的手动输入 `---` 依旧可行；

> [!abstract] YAML 语法规则
> 大小写敏感，可以使用中文
> 冒号后要跟一个空格
> 使用缩进来代表层级关系
> 缩进时只能用空格，不能用 tab
> 缩进的空格数不重要，但是同一级元素必须左对齐
> 用井号标识注释，从 `#` 到当前行的末尾是注释


注意
+ 如果你的 YAML 格式正确，则阅读模式下会自动隐藏，否则会标红报错
+ 占位符里的冒号后有空格，如 {{time: HH:mm}} ，留意占位符里的 time,或者 date 冒号后面也是要添加一个空格的
+ 可以使用所有字符作为键 or 值（包括 emoji 在内），但若放在键的位置，则仍需要放入中括号中，除了 task 的情况
+ dv 检索时，原关键字的值的格式必须正确，否则 dv 会报错，但这种情况下不是代码写错了，而是代码检索的对象有问题

Inline Fields 行内字段
如果元数据针对文件中的某一个区域中，dataview 提供 使用内联字段插入元数据到文件中的某个区域

书名:: ddd

行内字段插入某一行
```
读完这本的感受：[feel:: ...]；
读完这本的感受：(feelisthewordafter:: ...)；
```

`圆括号` 括起来的在阅读模式下不会显示 `key`


## 向列表和任务添加元数据

```
普通写法：用行内字段添加元数据[due:: 2023-07-20]
简便写法：省略了两个冒号，换成一个Emoji来简记
```

> [!TIP]
> 对于 obsidian 来说，任务和列表（有序列表和无序列表）实际上是同一类数据的不同形式，都可以用这种方法为他们加上元数据来方便后续的查询；


## Dataview 中的 Metadata 的数据类型

Metadata 是一个键值对（Key - Value，在这里称 Field Name - Field）

我们为文件添加元数据后，不一定会采用我们给定的格式，它会在**内部**（不会显示）自动对 Field Name 值进行一定修改，以保证格式统一。

> [!abstract] Field Name 值自动修改规则
> 如果有粗体、斜体等格式，格式会被擦除，变成普通文本
> 如果中间无空格，原本有大写的 Key 值和全部字母小写后的值都可以当作其 Key 值
> 如果中间有空格，会被替换成 `-`，并且所有大写字母会被换成小写字母

### Field 属性域
属性域具有数据类型，也就是说，它能够区分数字、文字、时间类型等。不同的数据类型具有不同的信息，比如数字有可以量化的信息，文字有内容信息，时间有年月日信息，布尔类型有真假信息。有了不同的数据类型，我们才可以更高效且准确的进行查询，因此数据类型非常有必要存在

string 字符串
默认的数据类型，也是最常用的数据类型，当一个 Field 没有对应的数据类型时，就是 string 类型

number 数字类型
不区分整数还是小数，全部为数字类型

boolean 布尔类型
true 和 false

date 时间类型
匹配 [ISO8601表示法](https://pkmer.cn/Pkmer-Docs/10-obsidian/obsidian%E7%A4%BE%E5%8C%BA%E6%8F%92%E4%BB%B6/dataview/dataview%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/42---iso-8601) 的文本将自动转换为日期对象；

从时间域 field 中提取信息

`field.year` 获取年份
`field.month` 获取月份
`field.weekyear` 获取周数（从每年的第一天开始算，一年约 52 周）
`field.week` 获取周数（从每个月第一天，一月约 4 周）
`field.weekday` 获取星期数（星期 1 为 1、星期 2 为 2）
`field.day` 获取天数
`field.hour` 获取小时数
`field.minute` 获取分钟数
`field.second` 获取秒数
`field.millisecond` 获取纳秒数

duration 

Date 时间是指一个时间点，而 Duration 是指一段时间。比如 1 分钟、1 天、1 年等；


## 字面常量

一般字面常量

### 日期的字面常量

## Dataview 支持的四种查询方式

### LIST 列表

LIST 查询时，会将结果组成一个无序列表，包含文件链接或组名 (如果决定分组)。除了文件信息外，最多还可以指定一个要输出的附加信息。

如果只有一个简单的 LIST 而没有其他的约束条件，他就会把库中的所有的文件以列表的形式展现出来（只有 Query Types 且不包含其他任何信息的时候，需要在结尾加一个空格）；

配合 Field 使用
Field 需要填写的是元数据或者他们组成的表达式

用 WITHOUT 去除第一个属性
一般 List 查询会展示文件的链接以及一个 Field 附加的属性，如果不想要展示文件的链接，我们可以在 `list` 后面加上 `without id`，再后面继续跟上需要的 Field 即可（如果不写属性的话还是会显示文件的链接）

dataview
LIST WITHOUT ID file.path


### Table

TABLE 查询类型将页面数据输出为表格视图。

- 可以用逗号分隔来同时查询多个属性；
- 可以使用纯元数据字段作为列，还可以指定计算；
- 与所有其他查询类型一样，你可以配合其他函数来优化查询的结果；


### TASK 任务

TASK 查询将库中符合给定条件 (如果有的话) 的所有任务生成一个交互式列表。TASK 查询与其他查询类型相比是特殊的，因为它们返回的结果是任务，而不是页面。这意味着所有数据命令都在任务级别上操作，并且可以对任务进行细粒度过滤。（即筛选最小的范围从页面级到了任务级，可以根据任务本身的元数据进行过滤）


### CALENDAR 日历

- CALENDAR 查询输出一个月的日历，其中每个结果都用一个点表示在对应的日期上。
- CALENDAR 是唯一需要附加信息的查询类型，并且附加信息需要是日期。

dataview
CALENDAR due 
WHERE typeof(due) = "date" 
![[file-pasted-20241228161915689.png]]

其中，里面某一天里面的每一个点就代表一个查询结果（文件），光标移动到点出就可以预览对应的文件。文件分布在哪一天是由代码中的 `file.ctime` 决定的；


